{"ast":null,"code":"class AuthService {\n  static isAuthenticated() {\n    const token = localStorage.getItem('auth_token');\n    console.log('AuthService.isAuthenticated():', token ? 'ЕСТЬ токен' : 'НЕТ токена');\n    return !!token;\n  }\n  static getUserData() {\n    try {\n      const userDataStr = localStorage.getItem('user_data');\n      const userData = userDataStr ? JSON.parse(userDataStr) : null;\n      return userData;\n    } catch (error) {\n      console.error('Ошибка при чтении user_data:', error);\n      return null;\n    }\n  }\n  static getUserName() {\n    const userData = this.getUserData();\n    if (userData) {\n      return userData.name || userData.email || '';\n    }\n    return '';\n  }\n  static getUserId() {\n    const userData = this.getUserData();\n    return userData ? userData.id : null;\n  }\n  static getToken() {\n    return localStorage.getItem('auth_token');\n  }\n  static logout() {\n    console.log('AuthService.logout()');\n    localStorage.removeItem('auth_token');\n    localStorage.removeItem('user_data');\n    localStorage.removeItem('user_id');\n    localStorage.removeItem('user_email');\n    // Отправляем событие для обновления компонентов\n    const authChangeEvent = new Event('authChange');\n    window.dispatchEvent(authChangeEvent);\n  }\n  static login(token, userData) {\n    console.log('AuthService.login(): сохранение токена и данных пользователя');\n    localStorage.setItem('auth_token', token);\n    if (userData) {\n      localStorage.setItem('user_data', JSON.stringify(userData));\n      if (userData.id) {\n        localStorage.setItem('user_id', userData.id.toString());\n      }\n    }\n    // Отправляем событие для обновления компонентов\n    const authChangeEvent = new Event('authChange');\n    window.dispatchEvent(authChangeEvent);\n  }\n  static updateUserData(newData) {\n    try {\n      const currentData = this.getUserData() || {};\n      const updatedData = {\n        ...currentData,\n        ...newData\n      };\n      localStorage.setItem('user_data', JSON.stringify(updatedData));\n      const userDataUpdateEvent = new Event('userDataUpdate');\n      window.dispatchEvent(userDataUpdateEvent);\n      return updatedData;\n    } catch (error) {\n      console.error('Ошибка при обновлении данных пользователя:', error);\n      return null;\n    }\n  }\n\n  // НОВЫЕ МЕТОДЫ ДЛЯ ДОБАВЛЕНИЯ ОБЪЯВЛЕНИЙ\n\n  static setToken(token) {\n    console.log('AuthService.setToken(): установка токена', token ? 'есть' : 'нет');\n    localStorage.setItem('auth_token', token);\n    // Отправляем событие для обновления компонентов\n    const authChangeEvent = new Event('authChange');\n    window.dispatchEvent(authChangeEvent);\n  }\n  static saveUserData(userData) {\n    console.log('AuthService.saveUserData(): сохранение данных пользователя:', userData);\n    localStorage.setItem('user_data', JSON.stringify(userData));\n    if (userData.id) {\n      localStorage.setItem('user_id', userData.id.toString());\n    }\n    // Отправляем событие для обновления компонентов\n    const userDataUpdateEvent = new Event('userDataUpdate');\n    window.dispatchEvent(userDataUpdateEvent);\n  }\n\n  // Метод для автоматического входа после регистрации через форму добавления объявления\n  static loginAfterRegistration(token, formData) {\n    console.log('AuthService.loginAfterRegistration(): автоматический вход после регистрации');\n\n    // Сохраняем токен\n    localStorage.setItem('auth_token', token);\n\n    // Создаем объект пользователя из данных формы\n    const userData = {\n      name: formData.name || '',\n      email: formData.email || '',\n      phone: formData.phone || '',\n      // ID будет получен позже из API, временно используем email как идентификатор\n      id: formData.email || Date.now()\n    };\n\n    // Сохраняем данные пользователя\n    localStorage.setItem('user_data', JSON.stringify(userData));\n    localStorage.setItem('user_id', userData.id.toString());\n    console.log('Автоматический вход выполнен. Данные пользователя:', userData);\n\n    // Отправляем событие для обновления компонентов\n    const authChangeEvent = new Event('authChange');\n    window.dispatchEvent(authChangeEvent);\n  }\n\n  // Метод для проверки, нужно ли показывать модальное окно с паролем для авторизованных пользователей\n  static shouldShowPasswordModal() {\n    return this.isAuthenticated();\n  }\n\n  // Метод для очистки только данных пользователя (без токена)\n  static clearUserData() {\n    console.log('AuthService.clearUserData(): очистка данных пользователя');\n    localStorage.removeItem('user_data');\n    localStorage.removeItem('user_id');\n    localStorage.removeItem('user_email');\n    const userDataUpdateEvent = new Event('userDataUpdate');\n    window.dispatchEvent(userDataUpdateEvent);\n  }\n\n  // Метод для полной очистки (аналогично logout)\n  static clearAll() {\n    this.logout();\n  }\n\n  // Метод для проверки наличия email в localStorage (для предзаполнения форм)\n  static getStoredEmail() {\n    return localStorage.getItem('user_email');\n  }\n\n  // Метод для сохранения email (например, после успешной регистрации)\n  static saveEmail(email) {\n    if (email) {\n      localStorage.setItem('user_email', email);\n    }\n  }\n\n  // Метод для получения статуса регистрации (нужен для формы добавления объявления)\n  static getRegistrationStatus() {\n    return {\n      isAuthenticated: this.isAuthenticated(),\n      userData: this.getUserData(),\n      hasEmail: !!localStorage.getItem('user_email')\n    };\n  }\n}\nexport default AuthService;","map":{"version":3,"names":["AuthService","isAuthenticated","token","localStorage","getItem","console","log","getUserData","userDataStr","userData","JSON","parse","error","getUserName","name","email","getUserId","id","getToken","logout","removeItem","authChangeEvent","Event","window","dispatchEvent","login","setItem","stringify","toString","updateUserData","newData","currentData","updatedData","userDataUpdateEvent","setToken","saveUserData","loginAfterRegistration","formData","phone","Date","now","shouldShowPasswordModal","clearUserData","clearAll","getStoredEmail","saveEmail","getRegistrationStatus","hasEmail"],"sources":["C:/Users/1874-23/Desktop/getpetback/src/services/AuthService.js"],"sourcesContent":["class AuthService {\r\n    static isAuthenticated() {\r\n        const token = localStorage.getItem('auth_token');\r\n        console.log('AuthService.isAuthenticated():', token ? 'ЕСТЬ токен' : 'НЕТ токена');\r\n        return !!token;\r\n    }\r\n\r\n    static getUserData() {\r\n        try {\r\n            const userDataStr = localStorage.getItem('user_data');\r\n            const userData = userDataStr ? JSON.parse(userDataStr) : null;\r\n            return userData;\r\n        } catch (error) {\r\n            console.error('Ошибка при чтении user_data:', error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    static getUserName() {\r\n        const userData = this.getUserData();\r\n        if (userData) {\r\n            return userData.name || userData.email || '';\r\n        }\r\n        return '';\r\n    }\r\n\r\n    static getUserId() {\r\n        const userData = this.getUserData();\r\n        return userData ? userData.id : null;\r\n    }\r\n\r\n    static getToken() {\r\n        return localStorage.getItem('auth_token');\r\n    }\r\n\r\n    static logout() {\r\n        console.log('AuthService.logout()');\r\n        localStorage.removeItem('auth_token');\r\n        localStorage.removeItem('user_data');\r\n        localStorage.removeItem('user_id');\r\n        localStorage.removeItem('user_email');\r\n        // Отправляем событие для обновления компонентов\r\n        const authChangeEvent = new Event('authChange');\r\n        window.dispatchEvent(authChangeEvent);\r\n    }\r\n\r\n    static login(token, userData) {\r\n        console.log('AuthService.login(): сохранение токена и данных пользователя');\r\n        localStorage.setItem('auth_token', token);\r\n        if (userData) {\r\n            localStorage.setItem('user_data', JSON.stringify(userData));\r\n            if (userData.id) {\r\n                localStorage.setItem('user_id', userData.id.toString());\r\n            }\r\n        }\r\n        // Отправляем событие для обновления компонентов\r\n        const authChangeEvent = new Event('authChange');\r\n        window.dispatchEvent(authChangeEvent);\r\n    }\r\n\r\n    static updateUserData(newData) {\r\n        try {\r\n            const currentData = this.getUserData() || {};\r\n            const updatedData = { ...currentData, ...newData };\r\n            localStorage.setItem('user_data', JSON.stringify(updatedData));\r\n            const userDataUpdateEvent = new Event('userDataUpdate');\r\n            window.dispatchEvent(userDataUpdateEvent);\r\n            return updatedData;\r\n        } catch (error) {\r\n            console.error('Ошибка при обновлении данных пользователя:', error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    // НОВЫЕ МЕТОДЫ ДЛЯ ДОБАВЛЕНИЯ ОБЪЯВЛЕНИЙ\r\n\r\n    static setToken(token) {\r\n        console.log('AuthService.setToken(): установка токена', token ? 'есть' : 'нет');\r\n        localStorage.setItem('auth_token', token);\r\n        // Отправляем событие для обновления компонентов\r\n        const authChangeEvent = new Event('authChange');\r\n        window.dispatchEvent(authChangeEvent);\r\n    }\r\n\r\n    static saveUserData(userData) {\r\n        console.log('AuthService.saveUserData(): сохранение данных пользователя:', userData);\r\n        localStorage.setItem('user_data', JSON.stringify(userData));\r\n        if (userData.id) {\r\n            localStorage.setItem('user_id', userData.id.toString());\r\n        }\r\n        // Отправляем событие для обновления компонентов\r\n        const userDataUpdateEvent = new Event('userDataUpdate');\r\n        window.dispatchEvent(userDataUpdateEvent);\r\n    }\r\n\r\n    // Метод для автоматического входа после регистрации через форму добавления объявления\r\n    static loginAfterRegistration(token, formData) {\r\n        console.log('AuthService.loginAfterRegistration(): автоматический вход после регистрации');\r\n\r\n        // Сохраняем токен\r\n        localStorage.setItem('auth_token', token);\r\n\r\n        // Создаем объект пользователя из данных формы\r\n        const userData = {\r\n            name: formData.name || '',\r\n            email: formData.email || '',\r\n            phone: formData.phone || '',\r\n            // ID будет получен позже из API, временно используем email как идентификатор\r\n            id: formData.email || Date.now()\r\n        };\r\n\r\n        // Сохраняем данные пользователя\r\n        localStorage.setItem('user_data', JSON.stringify(userData));\r\n        localStorage.setItem('user_id', userData.id.toString());\r\n\r\n        console.log('Автоматический вход выполнен. Данные пользователя:', userData);\r\n\r\n        // Отправляем событие для обновления компонентов\r\n        const authChangeEvent = new Event('authChange');\r\n        window.dispatchEvent(authChangeEvent);\r\n    }\r\n\r\n    // Метод для проверки, нужно ли показывать модальное окно с паролем для авторизованных пользователей\r\n    static shouldShowPasswordModal() {\r\n        return this.isAuthenticated();\r\n    }\r\n\r\n    // Метод для очистки только данных пользователя (без токена)\r\n    static clearUserData() {\r\n        console.log('AuthService.clearUserData(): очистка данных пользователя');\r\n        localStorage.removeItem('user_data');\r\n        localStorage.removeItem('user_id');\r\n        localStorage.removeItem('user_email');\r\n\r\n        const userDataUpdateEvent = new Event('userDataUpdate');\r\n        window.dispatchEvent(userDataUpdateEvent);\r\n    }\r\n\r\n    // Метод для полной очистки (аналогично logout)\r\n    static clearAll() {\r\n        this.logout();\r\n    }\r\n\r\n    // Метод для проверки наличия email в localStorage (для предзаполнения форм)\r\n    static getStoredEmail() {\r\n        return localStorage.getItem('user_email');\r\n    }\r\n\r\n    // Метод для сохранения email (например, после успешной регистрации)\r\n    static saveEmail(email) {\r\n        if (email) {\r\n            localStorage.setItem('user_email', email);\r\n        }\r\n    }\r\n\r\n    // Метод для получения статуса регистрации (нужен для формы добавления объявления)\r\n    static getRegistrationStatus() {\r\n        return {\r\n            isAuthenticated: this.isAuthenticated(),\r\n            userData: this.getUserData(),\r\n            hasEmail: !!localStorage.getItem('user_email')\r\n        };\r\n    }\r\n\r\n}\r\n\r\nexport default AuthService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}